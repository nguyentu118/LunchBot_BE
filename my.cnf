# Fix quyền file my.cnf trên Windows

Write-Host "Fixing my.cnf permissions..." -ForegroundColor Yellow

# Stop container
docker-compose down

# Xóa my.cnf cũ
Remove-Item my.cnf -Force -ErrorAction SilentlyContinue

# Tạo lại với encoding đúng
$myCnfContent = @"
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init-connect = 'SET NAMES utf8mb4'
skip-character-set-client-handshake

[mysqldump]
default-character-set = utf8mb4
"@

# Lưu với UTF-8 (không BOM)
[System.IO.File]::WriteAllText("$PWD\my.cnf", $myCnfContent, [System.Text.UTF8Encoding]::new($false))

Write-Host "✓ Đã tạo lại my.cnf" -ForegroundColor Green

# Restart
docker-compose up -d

Write-Host "✓ Done! Chờ 20 giây..." -ForegroundColor Green
Start-Sleep -Seconds 20

Write-Host "`nKiểm tra lại:" -ForegroundColor Cyan
docker exec mysql_lunchbot mysql -u root -panhtu2003 -e "SHOW VARIABLES LIKE 'character%';"